---
title: "Final"
author: "Emily Mauch"
date: "4/18/2022"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Packages to install, include=FALSE}
install.packages("naniar")
install.packages("igraph")
```

```{r Packages to open, include=FALSE}
library(tidyverse)
library(rvest) 
library(naniar)
library(igraph)
```


```{r}
#Function : data
#Input : a url to a 50 of the top 1000 movies. Selects and formats movie rank, title, year, directors/actors, votes/gross
#Output : a data frame of 50 movies with variables above

data <- function(x){
  html <- read_html(x)
  top_50 <- html_nodes(html, ".sort-num_votes-visible , .text-muted+ p , .genre , .unbold , .lister-item-header a")
  a <- html_text(top_50) 
  b <- str_replace_all(a, "[\r\n]" , "")
  c <- str_replace_all(b, "[ ]+" , "")
  x <- gsub("[()]", "", c)   
  as.data.frame(matrix(x, ncol = 6, nrow = 50, byrow= TRUE))
}


a <- data("https://www.imdb.com/search/title/?groups=top_1000&start=1")
b <- data("https://www.imdb.com/search/title/?groups=top_1000&start=51&ref_=adv_nxt")
c <- data("https://www.imdb.com/search/title/?groups=top_1000&start=101&ref_=adv_nxt")
d <- data("https://www.imdb.com/search/title/?groups=top_1000&start=151&ref_=adv_nxt")
e <- data("https://www.imdb.com/search/title/?groups=top_1000&start=201&ref_=adv_nxt")
f <- data("https://www.imdb.com/search/title/?groups=top_1000&start=251&ref_=adv_nxt")
g <- data("https://www.imdb.com/search/title/?groups=top_1000&start=301&ref_=adv_nxt")
h <- data("https://www.imdb.com/search/title/?groups=top_1000&start=351&ref_=adv_nxt")
i <- data("https://www.imdb.com/search/title/?groups=top_1000&start=401&ref_=adv_nxt")
j <- data("https://www.imdb.com/search/title/?groups=top_1000&start=451&ref_=adv_nxt")
k <- data("https://www.imdb.com/search/title/?groups=top_1000&start=501&ref_=adv_nxt")
l <- data("https://www.imdb.com/search/title/?groups=top_1000&start=551&ref_=adv_nxt")
m <- data("https://www.imdb.com/search/title/?groups=top_1000&start=601&ref_=adv_nxt")
n <- data("https://www.imdb.com/search/title/?groups=top_1000&start=651&ref_=adv_nxt")
o <- data("https://www.imdb.com/search/title/?groups=top_1000&start=701&ref_=adv_nxt")
p <- data("https://www.imdb.com/search/title/?groups=top_1000&start=751&ref_=adv_nxt")
q <- data("https://www.imdb.com/search/title/?groups=top_1000&start=801&ref_=adv_nxt")
r <- data("https://www.imdb.com/search/title/?groups=top_1000&start=851&ref_=adv_nxt")
s <- data("https://www.imdb.com/search/title/?groups=top_1000&start=901&ref_=adv_nxt")
t <- data("https://www.imdb.com/search/title/?groups=top_1000&start=951&ref_=adv_nxt")

top_1000 <- rbind(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t)
```



```{r}
#Formatting data frame 

top <- top_1000 %>% separate(V1, c("Rank", NA), sep="[.]") %>%
  separate(V4, c("Genre1", "Genre2", "Genre3"), sep="[,]")%>%
  separate(V5, c("Director", "Actor"), sep = "[|]") %>%
  separate(Director, c(NA, "Director"), sep = "[:]") %>%
  separate(Actor, c(NA, "Actors"), sep = "[:]")%>%
  separate(V6, c("Votes", "Gross"), sep = "[|]", extra="merge")  %>%
  separate(Votes, c(NA, "Votes"), sep = "[:]") %>% 
  rename("Title" = "V2", "Year"="V3") %>% 
  separate(Actors, c("Actor1", "Actor2", "Actor3", "Actor4"), sep = "[,]") %>%
  separate(Gross, c("Gross1", "Gross2"), sep="[:]") %>% 
  separate(Gross2, c("Gross2", "Gross3"), sep = "[|]") %>% 
  separate(Gross2, c("Gross2", "Gross4"), sep = "[#]") %>%
  select("Rank":"Votes", "Gross2")%>%
  rename("Gross" = "Gross2") %>%
  replace_with_na(replace = list(Gross = ""))
```

```{r}
#Producing data frame "actors". Contains 3 rows per movie that correlates each actor in the movie to the "top" actor. Modified top for graphing 
#Format must be "Actor1", "Actor2" then "title"
top_longer <- top  %>% 
  select(Title, Actor1:Actor4)%>%
  pivot_longer(cols= "Actor2":"Actor4",names_to= "Remove", values_to = 'Actor2') %>% 
  select(-"Remove") 
col_order <- c("Actor1", "Actor2", "Title")
top_longer <- top_longer[, col_order]

#Producing Data frame "Actors" contains just actors and removes all duplicates. Needed for graphing function 
Actors <- top %>% 
  select(Actor1:Actor4) %>%  
  pivot_longer(cols= "Actor1":"Actor4",names_to= "Remove", values_to = 'Actor') %>% 
  select(-"Remove")
Actors <-  distinct(Actors)
```


```{r}
#Producing actor network plot 
#Input:
  #d: data frame with top actor linked the 2nd, 3rd and 4th actors divided out by movie
  #vertices: Just a list of all of the actors in movies 
  #direct = FALSE due to multiple actors in multiple movies and aren't directed linked to every other actor 
#Output: list of actors and who they are related to 
actorNetwork <- graph_from_data_frame(d=top_longer, vertices=Actors, directed=FALSE)
plot(actorNetwork)
```


